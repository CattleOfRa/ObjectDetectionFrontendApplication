<!doctype html>
<html class="no-js" lang="">

<head>
    <meta charset="utf-8">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#fafafa">
    <script src="http://code.jquery.com/jquery-latest.min.js"></script>
</head>

<body>
    {% csrf_token %}
    <div id="unique_id" style="visibility: hidden;">{{ unique_id }}</div>
    <div id="laptops_label">Laptops</div>
    <div id="laptops_images"></div>
    <div id="keyboards_label">Keyboards</div>
    <div id="keyboards_images"></div>
    <div id="faces_label">Faces</div>
    <div id="faces_images"></div>
</body>

<script>
    $(document).ready(function() {

        var total_number_of_laptops = 0;
        var total_number_of_keyboards = 0;
        var total_number_of_faces = 0;

        var csrftoken = jQuery("[name=csrfmiddlewaretoken]").val();

        $.ajaxSetup({
            beforeSend: function (xhr, settings) {
                // if not safe, set csrftoken
                if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                    xhr.setRequestHeader("X-CSRFToken", csrftoken);
                }
            },
            cache: false
        });

        function csrfSafeMethod(method) {
            return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
        }

        $.ajaxSetup({
        beforeSend: function (xhr, settings) {
            // if not safe, set csrftoken
            if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                xhr.setRequestHeader("X-CSRFToken", csrftoken);
            }
        }
    });

        var my_refresh = setInterval(function() {
            $.ajax({
                type: "POST",
                url:"/get_images/",
                data: {
                    'unique_id': $('#unique_id').text()
                },
                success: function(data){
                    $.each( data['laptop'], function( i, item ) {
                        total_number_of_laptops += 1;
                        $( "<img style=\"max-height: 50px;\">" ).attr( "src", "http://127.0.0.1:8000/media" + item ).appendTo("#laptops_images");
                        $('#laptops_label').text("Laptops (" + total_number_of_laptops + ")")
                    });

                    $.each( data['keyboard'], function( i, item ) {
                        total_number_of_keyboards += 1;
                        $( "<img style=\"max-height: 50px;\">" ).attr( "src", "http://127.0.0.1:8000/media" + item ).appendTo("#keyboards_images");
                        $('#keyboards_label').text("Keyboards (" + total_number_of_keyboards + ")")
                    });

                    $.each( data['face'], function( i, item ) {
                        total_number_of_faces += 1;
                        $( "<img style=\"max-height: 50px;\">" ).attr( "src", "http://127.0.0.1:8000/media" + item ).appendTo("#faces_images");
                        $('#faces_label').text("Faces (" + total_number_of_faces + ")")
                    });
                }
            });
            }, 2000);
    });
</script>

</html>
